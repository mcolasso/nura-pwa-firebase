<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nura - Acessar Conta</title>
    
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#16a34a">

    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body>

    <header>
        <div class="container header-inner">
            <a href="../index.html" class="logo">Nura<span>.</span></a>
            <a href="../index.html" style="font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="ph-bold ph-arrow-left"></i> Voltar
            </a>
        </div>
    </header>

    <div class="auth-wrapper">
        <div class="auth-card">
            <div class="auth-header">
                <h1 class="logo" style="font-size: 2rem; margin-bottom: 0.5rem;">Nura<span>.</span></h1>
                <p style="color: var(--muted); font-size: 0.9rem;">Acesse sua conta ou crie uma nova</p>
            </div>

            <div class="tabs">
                <button class="tab-btn active" data-target="login-form">Login</button>
                <button class="tab-btn" data-target="signup-form">Cadastro</button>
            </div>

            <div id="login-form" class="form-content active">
                <form id="form-login">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="login-email" class="input" placeholder="seu@email.com" required>
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" id="login-senha" class="input" placeholder="••••••••" required>
                    </div>
                    <button type="submit" id="btn-entrar" class="btn btn-primary btn-full">Entrar</button>
                </form>
            </div>

            <div id="signup-form" class="form-content">
                <form id="form-cadastro">
                    <div class="form-group">
                        <label>Nome Completo</label>
                        <input type="text" id="cadastro-nome" class="input" placeholder="Seu nome" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="cadastro-email" class="input" placeholder="seu@email.com" required>
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" id="cadastro-senha" class="input" placeholder="••••••••" required>
                    </div>
                    <button type="submit" id="btn-cadastrar" class="btn btn-primary btn-full">Criar Conta</button>
                </form>
            </div>
        </div>
    </div>

    <footer>
        <div class="container" style="text-align: center; padding: 2rem 0;">
            <p style="color: var(--muted); font-size: 0.85rem;">&copy; 2025 Nura. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script src="../scripts/script.js"></script>

    <script type="module">
        // 1. Importar Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            updateProfile 
        } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

        // 2. Configuração
        const firebaseConfig = {
            apiKey: "AIzaSyBoSeMo0JROnkjtNPQXCyt9Ezzi_pUrtN8",
            authDomain: "nura-firebase-aula24112025.firebaseapp.com",
            projectId: "nura-firebase-aula24112025",
            storageBucket: "nura-firebase-aula24112025.firebasestorage.app",
            messagingSenderId: "622140430264",
            appId: "1:622140430264:web:5622fe037075fbe723614d"
        };

        // 3. Inicializar
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        console.log("Firebase conectado com sucesso!");

        // 4. Lógica de CADASTRO
        document.getElementById('form-cadastro').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const nome = document.getElementById('cadastro-nome').value;
            const email = document.getElementById('cadastro-email').value;
            const senha = document.getElementById('cadastro-senha').value;
            const btn = document.getElementById('btn-cadastrar');

            try {
                btn.innerText = "Criando...";
                btn.disabled = true;

                // Cria usuário
                const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
                const user = userCredential.user;

                // Atualiza nome
                await updateProfile(user, { displayName: nome });

                alert("Conta criada com sucesso! Redirecionando...");
                window.location.href = "perfil.html";

            } catch (error) {
                console.error(error);
                btn.innerText = "Criar Conta";
                btn.disabled = false;
                
                let mensagem = "Erro ao criar conta.";
                if (error.code === 'auth/email-already-in-use') mensagem = "Este email já está em uso.";
                if (error.code === 'auth/weak-password') mensagem = "A senha é muito fraca (mínimo 6 caracteres).";
                if (error.code === 'auth/invalid-email') mensagem = "Email inválido.";
                
                alert(mensagem);
            }
        });

        // 5. Lógica de LOGIN
        document.getElementById('form-login').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('login-email').value;
            const senha = document.getElementById('login-senha').value;
            const btn = document.getElementById('btn-entrar');

            try {
                btn.innerText = "Entrando...";
                btn.disabled = true;

                await signInWithEmailAndPassword(auth, email, senha);
                
                // Se der certo, vai pro perfil
                window.location.href = "perfil.html";

            } catch (error) {
                console.error(error);
                btn.innerText = "Entrar";
                btn.disabled = false;

                let mensagem = "Erro ao entrar.";
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    mensagem = "Email ou senha incorretos.";
                }
                
                alert(mensagem);
            }
        });
    </script>
</body>
</html>